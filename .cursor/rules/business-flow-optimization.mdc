# 業務フロー最適化ルール

## 概要
業務フローやシーケンス図を作成する際の簡潔化・最適化ガイドライン

## 適用トリガー
- Mermaid図での業務フロー作成時
- シーケンス図の冗長性が指摘された時
- 「もっと短く」「まとめて書く」「簡潔にして」等の要求

## 最適化原則

### 1. 画面単位統合ルール
**Before（避けるべき）**:
```
条件設定画面 → 高校選択 → 住所設定 → 学年設定 → フィルター設定
```

**After（推奨）**:
```
条件設定画面（高校・住所・学年・フィルター設定）
```

### 2. 括弧内詳細説明
- メインブロック名：画面名または処理名
- 括弧内：具体的な機能や詳細ステップ
- 改行（`<br/>`）で視覚的に整理

**例**:
```
[3. 条件設定・見積もり画面<br/>（高校・住所・学年・累積DM数フィルター<br/>+ リアルタイム件数・金額表示）]
```

### 3. ノード削減基準
- **統合対象**：同一画面内で実行される複数ステップ
- **残すべき要素**：画面遷移、判断分岐、外部システム連携
- **削除対象**：中間的な処理ステップ、確認画面への遷移

### 4. 番号付け体系
- 大項目：1, 2, 3...（画面単位）
- 派生項目：1-1, 1-2...（同画面内のサブ機能）

### 5. 視覚的改善
- **色分けルール維持**：画面/判断/処理の区別
- **矢印ラベル**：判断結果を簡潔に表示
- **ループ処理**：条件調整等は明確に表示

## 実装手順

1. **現状フロー分析**
   - 全ノード数をカウント
   - 画面遷移ポイントを特定
   - 冗長な中間ステップを洗い出し

2. **統合可能要素の特定**
   - 同一画面内の複数ステップ
   - 連続する確認・入力処理
   - 細分化されすぎた処理

3. **リファクタリング実行**
   - 画面単位でのブロック統合
   - 括弧内詳細説明の追加
   - 番号付け整理

4. **最終検証**
   - 情報の欠損がないか確認
   - 業務フローの論理的整合性チェック
   - 視覚的な分かりやすさの確認

## 品質基準

- **ノード数削減率**：50%以上の削減を目標
- **情報保持率**：100%（内容の欠損なし）
- **可読性向上**：画面要素と処理の区別が明確
- **実用性確保**：実際の画面設計に活用可能

## 適用例テンプレート

```mermaid
graph TD
    START([業務開始]) --> SCREEN1[1. 初期画面<br/>（ログイン・ダッシュボード）]
    SCREEN1 --> SCREEN2[2. 設定画面<br/>（条件入力・リアルタイム計算）]
    SCREEN2 --> DECISION{条件OK？}
    DECISION -->|No 再調整| SCREEN2
    DECISION -->|Yes| SCREEN3[3. 確定画面<br/>（最終確認・実行）]
    SCREEN3 --> END[完了]
```

このルールに従うことで、業務フローの本質を保持しながら、視覚的に理解しやすい図を作成できます。