# 移行スケジュールの概要書（ドラフト）

## 1. 目的 / 対象範囲
- 目的: 既存サイトから新システムへ安全かつ計画的に移行するための俯瞰資料。
- 対象: ドメイン/DNS/SSL証明書、サーバ/ホスティング、アプリ/DB、ストレージ（画像・添付）、外部SaaS/連携、運用ドキュメント、設定群。
- 方針: 現行影響を最小化し、段階移行（ステージング→本番）とロールバック手段を確保。

## 2. 引継ぎ対象一覧（What to carry over）
- ドメイン/DNS
  - ルートドメイン、サブドメイン（例: www, api, cdn）
  - DNSレコード（A/AAAA/CNAME/TXT/MX/SRV/CAA）
  - ネームサーバ委譲情報、DNSプロバイダの管理権限
- SSL/TLS 証明書
  - 既存証明書（発行先、SAN、鍵長、失効/更新日）
  - 自動更新設定（ACME/Let’s Encrypt or 商用CA）
- サーバ/インフラ
  - ホスティング種別（IaaS/PaaS/FaaS）、リージョン、スケール設定
  - OS/ランタイム/ミドルウェア（Nginx/Apache、Node/Python、DBバージョン）
  - バックアップ/監視/ログ基盤
- アプリケーション/データベース
  - アプリ資産（リポジトリ、ビルド/デプロイ方法、環境変数）
  - データベース（スキーマ、マイグレーション、データ量、文字コード/照合順序）
  - ジョブ/バッチ（スケジューラ、Cron/ワーカー設定）
- ストレージ/アセット
  - 画像/動画/添付（S3等のバケット構成、フォルダ規約、CDN有無）
  - キャッシュ/サムネイル再生成ポリシー
- 外部連携/SaaS
  - 決済、メール配送、分析タグ、認証、チャット等のAPIキー/シークレット
  - Webhook、IP許可リスト、コールバックURL
- 運用ドキュメント/設定
  - 手順書、運用SOP、既存Runbook
  - 監視閾値、アラートルール、権限/アカウント一覧

## 3. 環境差分と整備項目（Gap list）
- ランタイム/DBバージョン差分
- 文字コード/タイムゾーン/ロケール
- 認証方式（セッション/トークン/OIDC）
- ストレージパス/署名URL期限
- メール送信ドメイン認証（SPF/DKIM/DMARC）
- CDN/キャッシュ無効化手順

## 4. データ/アセット移送計画（How to migrate）
- データ移行
  - エクスポート→変換→インポート（スキーマ差分吸収、整合性チェック）
  - 増分同期（切替前のフリーズ短縮）
  - 検証: レコード件数/ハッシュ/サンプル照合
- アセット移行
  - 並行コピー（rsync/s3 sync）→ 署名URL/参照パス切替
  - 破損/参照切れ検知（サンプルアクセス、404監視）

## 5. カットオーバー手順（Go/No-Go とロールバック）
1) 事前
- ステージング最終リハーサル（E2E/性能/回帰）
- DNS TTL短縮、バックアップ取得、関係者アナウンス
2) 当日
- メンテナンス表示/書込フリーズ
- 最終増分移行、アプリ/DB起動確認
- ヘルスチェック合格後、DNS切替（A/CNAME）
- 監視/ログで異常検知確認、主要画面スポットテスト
3) ロールバック
- 切替後重大障害時、旧環境へDNS再切替
- 逆向き増分差分の取り扱いポリシー明記

## 6. リスクと対策
- DNS伝播遅延: TTL短縮、時間帯選定、段階的切替
- 互換性問題: 事前リハーサル/ブルーグリーン/Feature flag
- データ欠落: 二重書込/増分同期、整合性チェック
- 性能劣化: 負荷試験、スケール余裕、キャッシュ計画
- 運用手順齟齬: Runbook整備、当日役割表、連絡系統

## 7. 役割分担（RACI）
- Responsible: テックリード/インフラ担当
- Accountable: PM
- Consulted: セキュリティ、事業側担当
- Informed: サポート/広報

## 8. 高レベル移行スケジュール（試案）
- Week -2: 環境整備/リハーサル、DNS TTL短縮
- Week -1: フルデータ移行リハ、Runbook最終化
- Week 0（切替日）: 増分移行→DNS切替→モニタリング
- Week +1: 残課題フォロー、レポート/振り返り

## 9. 依存関係/前提
- 既存環境への管理者権限/APIアクセスが利用可能
- ドメイン/DNS/SSLの契約情報が入手可能
- 切替時間帯の公開合意（業務影響最小の時間帯）

---
最終版は現行環境の実測/検証結果を反映し、詳細手順・担当・時刻を協議の上で確定します。
